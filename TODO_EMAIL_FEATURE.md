# メール送信機能 実装仕様

## 概要
HP分析後、企業への営業メール送信を自動化する機能

## 送信ロジック

```
HP分析完了
    ↓
「営業お断り」あり？
    ├─ Yes → 🚫 送信不可（理由を表示）
    └─ No → メールアドレスあり？
              ├─ Yes → ✉️ Resend APIでメール送信
              └─ No → 📝 Playwrightでフォーム自動入力 → ユーザーが送信
```

## HP分析時の追加抽出項目

1. **メールアドレス** - 直接メール送信用
2. **お問い合わせフォームURL** - フォーム送信用
3. **「営業お断り」フラグ** - 送信可否の判定

## 提案メールの2パターン

| タイプ | 用途 | 長さ |
|--------|------|------|
| 通常版 | メール送信用 | 現在通り |
| 短文版 | フォーム送信用 | 3〜5文程度 |

## 技術スタック

### メール送信
- **Resend API** を使用
- 無料枠: 100通/日
- 必要: 送信元ドメインの認証（SPF/DKIM設定）

### フォーム自動入力
- **Playwright** を使用
- AIがフォーム構造を解析して適切なフィールドに入力
- ユーザーが最終確認して送信ボタンを押す
- CAPTCHA付きの場合はユーザーが解く

## UIイメージ

```
┌─────────────────────────────────────┐
│ 連絡方法: ✉️ メール                   │
│ アドレス: info@example.com          │
│ [メールを送信]                        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 連絡方法: 📝 お問い合わせフォーム      │
│ URL: example.com/contact            │
│ [フォームを開く] [短文をコピー]        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 連絡方法: 🚫 送信不可                 │
│ 理由: 営業お断りの記載があります       │
└─────────────────────────────────────┘
```

## 実装前の準備

1. [ ] Resendアカウント作成
2. [ ] 送信元ドメインの設定・認証
3. [ ] Resend APIキーを環境変数に追加

## 環境変数（追加）

```
RESEND_API_KEY=your_resend_api_key
```

---

*作成日: 2026-01-30*
